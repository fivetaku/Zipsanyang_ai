---
created: 2025-05-28 T23:11
modify: 2025-05-29 T21:53
---
---
## 0. 문서 정보 (Document Information)
- 제품명: **집사냥 AI**
- 문서 버전: **1.5**
- 작성일: 2025년 5월 21일

- 최종 수정일: 2025년 5월 28일

- 작성자: 프로젝트 담당팀

- 관련 팀/담당자: 기획, 디자인, 개발, 마케팅

- 변경 이력 (Change History):
- v1.5 (2025.05.28): **서비스 초점(아파트 매매 한정, 투자 목적 구체화), 모바일 웹앱 UX(채팅창 중심, Kakao 지도), Dify 워크플로우 상세화, DB스키마 변경(Airtable/Supabase 기준, Excel 데이터 참조), 추천 필터링 로직(Excel 데이터 기반 Top3), 유료화 및 이용 제한, 세션 리포트 등 대규모 업데이트 및 PRD 구조 개편.**
- v1.4 (2025.05.22): MVP 데이터 전략 수정 (**초기 배치 크롤링 데이터 기반 RAG, 실시간 연동은 MVP 이후**), Dify 자체 Vector DB 사용 명시, 개발 순서 재조정 (초기 크롤러 개발 강조), 프로젝트 디렉토리 구조 정의 추가.
- v1.3 (2025.05.22): MVP 범위 재조정 (지도 고급 필터/정렬 제외), 전체 문서 최종 검토.

- v1.2 (2025.05.22): MVP 기능 범위 확장 (실시간 데이터 목표 초기 명시, 대출 계산기 RAG 연동 등), 기술 스택, 아키텍처, 개발 순서 등 기술적 요구사항 상세화 (사용자 계정 기능은 최종 제외).

- v1.1 (2025.05.22): RAG 아키텍처 개념 도입, 데이터 전략 구체화, 캐릭터 대화 스타일, 네이버 지도 API 확정 등 1차 사용자 피드백 반영.

- v1.0 (2025.05.21): MVP 정의를 위한 초기 문서 작성.

## 1. 개요 (Overview / Executive Summary)
#### 1.1. 제품 요약 (Product Summary)
"**집사냥 AI**"는 **아파트 '매매'**를 고려하는 사용자들이 겪는 **정보 비대칭과 의사결정의 어려움을 해결하기 위한 모바일 웹앱 기반 대화형 AI 어드바이저 플랫폼**입니다. 친근한 "**집사 냥**" 캐릭터와 **Dify**를 활용하여 구축된, 초기 수집 데이터 기반 **RAG(Retrieval Augmented Generation) 챗 에이전트**를 통해 사용자의 다양한 매매 목적(**실거주 또는 갭투자**)과 복합적인 상황(연봉, 보유 현금, 출퇴근지 등)을 쉽고 자연스럽게 파악합니다. 개인에게 최적화된 아파트 단지 추천(**최대 3개, 초기 1개 언블러**)부터, 대출 관련 문서 기반의 RAG 안내 및 예상 대출액 계산, 그리고 세션 기반 개인 맞춤형 종합 리포트 생성까지 **원스톱으로 제공**하여 사용자의 성공적인 아파트 매매 여정을 지원하는 것을 목표로 합니다. 첫 화면은 **채팅창 중심**으로 구성되며, 필요시 **Kakao 지도 기반의 지도 뷰**로 전환하여 시각적인 정보를 제공합니다.
#### 1.2. 배경 및 문제 정의 (Background & Problem Statement) - 왜 만들어야 하는가?
아파트 매매는 개인의 삶에 중대한 영향을 미치는 재정적 결정이지만, 시장 정보는 방대하고 전문적이어서 지식과 경험이 부족한 개인, 특히 **20-40대 아파트 매매 초보자**에게는 높은 진입 장벽으로 작용합니다. 이들은 신뢰할 수 있는 아파트 가격 정보, 단지의 실제적인 장단점, 복잡한 시장 상황 분석, 개인의 재정 상황에 맞는 자금 조달 계획(특히 대출), 그리고 자신의 매매 목적(실거주 혹은 갭투자)에 부합하는 최적의 단지 선택에 큰 어려움을 느낍니다.
- 기존 서비스의 한계: 현재 부동산 정보 플랫폼들은 데이터를 제공하지만, **정보의 맥락적 이해나 개인 맞춤형 해석은 사용자의 몫**으로 남겨둡니다. 특히, 모바일 환경에서 복잡한 필터를 조작하거나 방대한 정보를 비교 분석하는 것은 사용자에게 피로감을 유발할 수 있습니다. 대화형으로 사용자의 숨은 니즈까지 파악하여 정제된 소수의 핵심 정보를 제공하는 서비스는 부족합니다.
- 사용자의 고충 (Pain Points):
	- 정보 과잉 및 신뢰성 부족: 어떤 정보를 믿고 활용해야 할지, 특히 특정 아파트 단지의 실질적인 가치와 나의 상황과의 적합성 판단이 어렵습니다.
	- 복잡한 의사결정: 다양한 변수(가격, 위치, 시장 상황, 대출, 세금, 투자 가치 등)를 매매 목적(실거주/갭투자)에 따라 **종합적으로 고려하여 최적의 결정을 내리기 어렵습니다.**
	- 자금 계획의 막막함: 자신의 연봉 수준에서 어느 정도의 대출이 가능한지, 어떤 대출 상품 정보를 참고해야 하는지 등 **대출 관련 정보 접근 및 이해가 어렵습니다.**
	- 시간 및 전문성 부족: 바쁜 일상 속에서 아파트 및 금융 정보를 충분히 학습하고 분석할 시간과 전문성이 부족합니다.
	- 심리적 불안감: 잘못된 결정으로 인한 금전적 손실이나 후회에 대한 두려움이 있습니다.
- 시장 기회: 사용자들은 단순 정보 제공을 넘어, 자신의 상황과 명확한 매매 목적(실거주/갭투자)에 맞는 **신뢰할 수 있는 분석과 조언**, 그리고 사용하기 쉬운 **모바일 중심의 인터페이스**를 통해 핵심 정보를 제공받기를 강력히 원하고 있습니다.
#### 1.3. 목표 및 기대 효과 (Goals & Objectives) - 만들어서 얻을 수 있는 목적은 무엇인가?
- 제품 비전: 모든 사용자가 자신의 아파트 매매 목적(**실거주 또는 갭투자**)을 성공적으로 달성할 수 있도록, **데이터 기반의 가장 스마트하고 신뢰할 수 있으며 사용하기 쉬운 모바일 AI 어드바이저가 되는 것**입니다.
- MVP 목표:
- 1. 핵심 가설 검증: **모바일 채팅창 중심 인터페이스**를 통해 사용자의 핵심 변수(매매 목적, 연봉, 보유 현금, 출퇴근지)를 자연스럽게 파악하고, 이를 바탕으로 **RAG 챗 에이전트**가 아파트 단지 정보 및 대출 관련 문서를 활용하여 **맞춤형 단지 추천(Top 3, 유료화 모델 연계)** 및 대출 정보 안내를 제공하는 **핵심 기능의 시장 수용성 및 효용성 검증.**
- 2. 사용자 경험(UX) 검증: "**집사 냥**" 캐릭터를 활용한 **모바일 대화형 인터페이스의 사용 편의성, 친밀도 및 정보 전달의 효과성 확인.** Kakao 지도 연동을 통한 시각적 정보 제공 만족도 확인.
- 3. 초기 사용자 확보 및 학습 데이터 수집: 핵심 타겟 사용자를 대상으로 초기 시장 반응을 확인하고, 향후 서비스 고도화를 위한 **실제 사용자 인터랙션, 선호도, 의사결정 패턴 데이터 확보.**
- 4. 기술적 실현 가능성 검증: 초기 데이터 수집(단순 크롤링), **Dify 기반 RAG 시스템 및 자체 Vector DB 운영**, 대출 문서 지식베이스 구축/활용, Kakao 지도 API 연동, 동적 리포트 생성 등 **핵심 기술 요소의 안정성 및 확장 가능성 초기 검증.**
- 5. 유료화 모델 초기 검증: 추천 결과 일부 블러 처리 및 유료 전환 유도 방식에 대한 사용자 반응 확인.
#### 1.4. 주요 기술 스택 (Key Technical Stack)
- Frontend: 모바일 웹앱 구현을 위한 경량 프레임워크 (예: React, Vue.js, Svelte - **AI Agent의 개발 생산성 및 PWA(Progressive Web App) 전환 용이성 고려**하여 선택)
- AI Orchestration / RAG Backend: **Dify** - LLM 연동, 지식베이스 관리, 프롬프트 엔지니어링, API 제공, 사용자 메시지 기반 변수 추출 및 워크플로우 실행 등 **RAG 파이프라인 구축 및 운영 활용.**
- Large Language Model (LLM): Dify에서 지원하는 모델 중 선택 (예: GPT-4o, Claude 3.5 Sonnet, 또는 **한국어 특화 모델 연동 고려**)
- Vector Database: **Dify 자체 Vector DB 사용** - 아파트 단지 정보 보고서 및 대출 관련 문서 임베딩 저장 및 검색.
- Structured Database (for filtering & core data): **Airtable 또는 Supabase** - apartments, price_history, transport, reviews, loan_products 등 정형 데이터 관리 및 **Dify 워크플로우의 query_apartments 단계에서 필터링을 위한 데이터 소스**로 활용.
- Data Collection (아파트 정보 - MVP 초기): Python (Scrapy, BeautifulSoup, Playwright 등) - 서울 주요 단지 대상 네이버 부동산 등에서 정보 수집을 위한 **단순 크롤러 개발.**
- Knowledge Base Documents (부동산 및 대출 정보): 초기 크롤러로 수집/가공된 아파트 단지 정보 보고서, 부동산 리뷰 요약 및 공신력 있는 출처의 대출 관련 문서(금융기관 안내서, 정부 자료 등)를 정제하여 **RAG 지식베이스로 구축.**
- Map API: **Kakao 지도 API** (JavaScript)
- Report Generation: 서버 사이드 PDF 생성 라이브러리 (예: ReportLab, WeasyPrint in Python - 필요시 Dify 외부 API로 구성) 또는 클라이언트 사이드 (jsPDF).
- Deployment: Docker, Kubernetes (향후 확장성 고려), 클라우드 플랫폼 (AWS, GCP, Azure 등) 또는 Vercel/Netlify (Frontend) - **AI Agent의 개발 환경 및 운영 편의성 고려.**
#### 1.5. 아키텍처 개요 (Architecture Overview)
"**집사냥 AI**" MVP는 모바일 웹앱 환경에서 **Dify를 중심으로 하는 RAG 기반 AI 어드바이저 시스템**으로 구성됩니다.
- 1. 사용자 인터페이스 (Frontend - Mobile Webapp):
	- **모바일 브라우저에 최적화된 웹 애플리케이션.** 첫 화면은 전체 채팅창으로 구성.
	- 사용자 입력(텍스트, 버튼) 및 "**지도 보기**" 버튼을 통한 Kakao 지도 뷰 전환 기능 제공.
	- Dify HTTP API와 통신하여 사용자 질의 전달 및 "**집사 냥**" 응답 표시.
- 2. AI 오케스트레이션 및 RAG 백엔드 (Dify 활용):
	- **System Prompt**: "**집사 냥**" 캐릭터의 역할, 말투, 전문 분야(아파트 매매, 대출 기본 안내), 사용자 정보 파악 항목 등을 정의.
	- 사용자 메시지 처리:
		- 1. **extract_vars(message)** (변수 추출 단계): LLM 또는 패턴 기반으로 사용자 메시지에서 주요 변수(매매 목적: 갭투자/실거주, 연봉, 보유 현금, 출퇴근지)를 추출하여 user_profile_vars (세션 기반 임시 저장)에 기록.
		- 2. **query_apartments(filters…)** (정형 데이터 필터링 단계):
			- 추출된 user_profile_vars와 (필요시) 추가적인 사용자 선호도(예: 면적)를 필터 조건으로 사용하여 **Airtable/Supabase의 apartments, price_history 테이블 등에서 1차 필터링된 아파트 ID 리스트(apt_id 리스트) 확보.** (예: deal_price ≤ cash + max_loan, area_m2 필터링 등)
			- 매매 목적(갭투자/실거주)에 따라 2차 필터링 및 **Top 3 단지 선정 로직 적용** (첨부된 Excel 데이터의 "**시가 대비 괴리율**", "**최근1년 상승률**", "**출퇴근 소요시간**", "**지하철역 거리**" 등 활용).
		- 3. **vector_search(apt_ids, “추천 이유”)** (비정형 데이터 검색 단계): 선정된 Top 3 apt_id 리스트를 기반으로 **Dify 자체 Vector DB의 부동산 KB**(단지 정보 보고서, 리뷰 요약 등)에서 각 단지별 "**추천 이유**"가 될 만한 긍정적 정보, 특징, 사용자 후기 등을 검색. 대출 관련 질의 시 대출 KB에서 관련 정보 검색.
		- 4. **LLM Generation** (답변 생성 단계): 검색된 정형/비정형 정보와 사용자 질의, 대화 맥락을 종합하여 LLM이 "**집사 냥**" 톤앤매너로 최종 응답(추천 단지 설명, 추천 이유, 대출 안내 등) 생성.
	- Frontend는 이 Dify 워크플로우를 단일 HTTP API 호출로 실행.
- 3. 지식베이스 (Knowledge Base - Dify Vector DB 연동):
	- **부동산 KB**: 초기 크롤링으로 수집 및 가공된 서울 주요 아파트 단지별 상세 정보 보고서, 관련 리뷰 요약.
	- **대출 KB**: 주택담보대출 관련 일반 정보, 상품 개요, 관련 법규 및 정책 문서.
- 4. 정형 데이터베이스 (**Airtable 또는 Supabase**):
	- apartments, price_history, transport, reviews, loan_products 등 **구조화된 데이터 저장.**
	- query_apartments 단계에서 Dify 워크플로우가 API 형태로 호출하여 필터링된 데이터 조회.
- 5. 초기 데이터 수집 모듈 (**단순 부동산 정보 크롤러 - MVP용**):
	- Python 기반 웹 크롤러. 네이버 부동산 등에서 아파트 단지 정보, 매물 정보(시세 중심) 등을 배치 형태로 수집.
	- 수집된 데이터를 정제/구조화하여 부동산 KB용 보고서 및 정형 DB용 데이터로 가공 후 초기 적재.
- 6. 외부 서비스 연동:
	- **Kakao 지도 API**: 지도 표시, 마커, 정보창 등 시각화 기능 제공.
(아키텍처 다이어그램은 별도의 문서 또는 도구를 통해 시각적으로 표현하고 관리합니다.)
## 2. 타겟 사용자 (Target Audience / Personas) - 누구를 위한 제품인가?
#### 2.1. 주요 타겟 고객 정의
아파트 '**매매**'(실거주 또는 갭투자 목적)를 통해 주거 안정 또는 자산 증식을 목표로 하며, 이를 위해 적극적으로 정보를 탐색하지만 **전문적인 분석과 개인 맞춤형 조언을 필요로 하는 20대 후반 ~ 40대 사용자 그룹.** 이들은 모바일 환경에 익숙하고, 부동산 관련 기본 지식은 다소 부족할 수 있으나, AI와 같은 새로운 기술을 활용한 문제 해결에 긍정적입니다. (전세 구매자는 핵심 대상이 아니며, 전세 거주자가 현금 보유량 관련 상담 시 자연스럽게 매매 전환을 고려할 수 있도록 유도하는 형태로만 가이드합니다.)
#### 2.2. 페르소나
- 페르소나 1: **이지혜 (33세, 대기업 7년 차 과장, 미혼, 생애 첫 아파트 '실거주' 매매 고려)**
	- 상황: 꾸준한 저축과 투자로 약 1억 5천만 원의 자산 형성, 생애 첫 '**내 집 마련**(아파트)' 목표. 현재 전세 거주 중이며, 매매로 전환 고려. 출퇴근 편의성과 함께 향후 자산 가치 상승도 중요하게 고려.
	- 고충: 어떤 지역/아파트 단지가 나의 조건(예산, 출퇴근지)에 맞는지, 내 연봉으로 대출은 얼마나 가능한지, 매수 타이밍은 언제가 좋은지 등 복합적인 고민. 모바일로 정보를 찾아보지만 너무 많고 판단 기준이 없어 불안.
	- "**집사냥 AI**"를 통해 얻고 싶은 가치: 나의 재정 상황(연봉, 보유 현금 기반 예상 대출액 포함)과 출퇴근지, 선호도를 반영한 **최적의 아파트 단지 추천** (초기 1곳 상세 정보, 나머지는 유료 확인 유도), 복잡한 대출 관련 기본 정보에 대한 쉬운 안내, 탐색 내용 요약 리포트.
- 페르소나 2: **박현우 (38세, 중견기업 팀장, 기혼, 자녀 1명, 현 주택 매도 후 아파트 '갈아타기(실거주)' 및 추가 '갭투자' 고려)**
	- 상황: 현재 주택 매도 후 더 나은 학군 또는 직주근접성이 좋은 아파트로 갈아타기 고려 중. 동시에 여유 자금으로 소형 아파트 갭투자(**시세차익 목적**)에도 관심.
	- 고충: 갈아타기(실거주)와 갭투자를 동시에 알아보려니 정보량이 너무 많고 각 목적에 맞는 필터링 기준 설정이 복잡함. 투자 가치 높은 아파트 단지 선별 안목 부족. 세금 문제 등 전문 지식 필요.
	- "**집사냥 AI**"를 통해 얻고 싶은 가치: 실거주 목적 갈아타기 단지와 갭투자 목적 단지를 구분하여 **맞춤형 아파트 포트폴리오 추천**, 각 단지의 투자 가치("**시가 대비 괴리율**", "**상승 모멘텀**" 등) 및 실거주 가치("**출퇴근 소요시간**", "**대중교통 접근성**" 등)에 대한 AI 분석, 대출 및 세금 관련 기본 정보 조언.
- 페르소나 3: **김민준 (29세, IT 스타트업 개발자, 미혼, 첫 '아파트 갭투자' 고려)**
	- 상황: 소액의 시드머니(약 5천만 원 ~ 1억 원)로 **첫 부동산 투자(아파트 갭투자) 희망.** 직장 생활로 바빠 많은 시간을 투자 정보 탐색에 할애하기 어려움. 장기적인 시세 차익 기대.
	- 고충: 어떤 아파트 단지가 소액으로 갭투자가 가능하면서도 향후 상승 잠재력이 있는지 판단하기 어려움. 전세가율, 매매가 대비 전세가 차액, 주변 개발 호재 등 고려할 정보가 많고 복잡함. 투자 리스크에 대한 막연한 불안감.
	- "**집사냥 AI**"를 통해 얻고 싶은 가치: 나의 보유 현금과 투자 성향에 맞는 **유망한 갭투자 가능 아파트 단지 추천(Top 3)**, 각 단지별 예상 갭투자 금액, "**시가 대비 괴리율**" 또는 "**단지별 상승 모멘텀**" 등 투자 지표에 대한 AI 분석, 관련 리스크 요인에 대한 간략한 안내.
## 3. 사용자 스토리 및 여정 (User Stories & Journeys)
#### 3.1. 핵심 사용자 스토리 (MVP)
- 이지혜 (첫 아파트 실거주 매매): "나는 생애 첫 아파트를 실거주 목적으로 알아보는 부동산 초보자로서, **집사냥 AI 챗봇에게 나의 연봉, 보유 현금, 희망 출퇴근지를 자연스럽게 이야기하고, 주택담보대출에 대해 질문하면, AI "집사 냥"이 학습된 대출 문서를 바탕으로 대출 관련 일반 정보를 안내해주고 예상 대출 가능액을 계산해주며, 이를 종합하여 나의 조건에 가장 적합한 아파트 단지 Top 3를 추천(첫 1곳 상세, 나머지 블러 처리)해주고, Kakao 지도로 위치를 확인시켜주며, 각 단지를 왜 추천하는지 친절하게 설명해주어, 어떤 집부터 알아봐야 할지 명확한 방향을 잡고 싶다. 최종적으로 오늘 대화 내용을 리포트로 다운로드 받고 싶다.**"
- 박현우 (아파트 갈아타기 및 갭투자): "나는 갈아타기와 갭투자를 동시에 고려하는 투자자로서, **집사냥 AI에게 나의 매매 목적(실거주 갈아타기, 갭투자), 각 목적별 예산 및 주요 조건을 전달하면, AI "집사 냥"이 각 목적에 맞는 유망 아파트 단지 후보군을 (각각 Top 3, 첫 1곳 상세) 제시하고, Kakao 지도에서 위치를 비교하며, 실거주 단지는 출퇴근 용이성, 갭투자 단지는 시가 대비 괴리율 또는 상승 모멘텀 등의 분석 코멘트를 제공받아, 나의 다음 투자 단계를 구체화하고 싶다.**"
- 김민준 (첫 아파트 갭투자): "나는 소액으로 첫 아파트 갭투자를 하고 싶은 직장인으로서, **집사냥 AI에게 나의 보유 현금, 투자 선호 지역(선택), 예상 투자 기간 등을 알려주면, AI "집사 냥"이 해당 조건에 부합하고 시가 대비 괴리율이나 상승 모멘텀이 좋은 갭투자 가능 아파트 단지 Top 3를 추천(첫 1곳 상세)해주고, 각 단지별 예상 갭금액 및 투자포인트에 대한 정보를 Kakao 지도와 함께 제공받아, 투자 대상을 효과적으로 압축하고 싶다.**"
#### 3.2. 핵심 사용자 여정 (MVP - 예시: 첫 아파트 실거주 매매자 이지혜)
- 1. 서비스 접속 (모바일 웹앱): 스마트폰 브라우저로 "**집사냥 AI**" 웹사이트에 접속하면, 화면 전체가 채팅창으로 구성된 첫 화면을 마주합니다. "**집사 냥**" 캐릭터가 반갑게 맞이합니다.
- 2. "**집사 냥**"과 대화 시작 및 정보 제공: 이지혜는 "집 마련 때문에 고민이야" 또는 "아파트 추천해줘" 등의 메시지를 입력합니다. "**집사 냥**"은 "**안녕하냥, 이지혜님! 어떤 아파트를 찾으시냥? 실거주 목적이시냥, 아니면 갭투자를 생각하시냥?**"과 같이 **매매 목적을 먼저 묻고, 이후 연봉, 보유 현금, 희망 출퇴근지** (예: "강남역 근처 회사 다녀요") 등의 정보를 자연스러운 대화를 통해 파악합니다.
- 3. 대출 정보 문의 및 RAG 기반 안내/계산: 이지혜가 "대출은 얼마나 받을 수 있을까?"라고 질문하면, "**집사 냥**"은 "**대출이 궁금하시구나냥! 일반적으로 LTV, DSR 같은 걸 보는데...(RAG 기반 설명)... 이지혜님 연봉과 보유 현금을 고려하면, 대략 X억원에서 Y억원 사이의 대출을 예상해볼 수 있다냥. 이건 참고용이니 자세한 건 은행과 꼭 상담하라냥!**"과 같이 안내하고 예상 대출액을 제시합니다.
- 4. AI의 조건 분석 및 아파트 단지 추천: "**집사 냥**"은 "**이지혜님의 소중한 정보 고맙다냥. 말씀해주신 내용과 대출 가능액을 종합해서 딱 맞는 아파트 단지를 찾아보겠다냥. 잠시만 기다려달라냥!**"과 같이 안내 후, **Dify 워크플로우를 통해 user_profile_vars를 업데이트하고, query_apartments 및 vector_search를 실행하여 Top 3 추천 단지를 선정합니다.**
- 5. 추천 결과 제시 (채팅창 & 유료화 연계): 챗봇창에 "**이지혜님을 위한 맞춤 아파트 단지 Top 3를 찾았다냥! 첫 번째 단지는 바로 [A단지명]이다냥!** (상세 설명 및 추천 이유 제시). 나머지 두 곳도 궁금하시냥? (유료 플랜 안내 또는 맛보기 정보)" 와 같이 **첫 번째 추천 단지의 정보는 상세히 보여주고, 나머지 2개는 블러 처리하거나 간략한 정보만 제공하며 유료 플랜을 유도**합니다. (MVP에서는 유료 결제 기능 없이, "자세히 보려면 문의하세요" 등으로 연결)
- 6. "**지도 보기**" 버튼 통한 Kakao 지도 뷰 확인: 이지혜가 채팅창 하단 또는 특정 메시지 옆의 "**지도 보기**" 버튼을 누르면, 화면이 Kakao 지도 뷰로 전환됩니다. 추천된 단지(언블러된 단지 중심, 또는 Top 3 모두 표시하되 블러된 단지는 제한적 정보)가 지도 위에 마커로 표시됩니다. 마커 클릭 시 해당 단지의 핵심 정보(주소, 시세 범위, "**집사 냥**의 한마디")가 간결한 정보창으로 표시됩니다.
- 7. 종합 리포트 생성 및 다운로드: 대화 말미에 이지혜가 "오늘 대화 정리해줘"라고 요청하면, "**집사 냥**"은 "**오늘 나눈 이야기와 추천 단지 정보를 리포트로 깔끔하게 정리했다냥! 아래 버튼으로 다운로드하시라냥!**"과 같이 안내하며 PDF 리포트를 제공합니다.
- 8. 추천 매물 부재 시 대응: 만약 조건에 맞는 단지가 없다면, "**집사 냥**"은 "**냥… 이지혜님의 조건에 딱 맞는 아파트를 지금은 찾지 못했다냥. 보유 현금을 조금 더 모으시거나, 대출을 더 받는 방법을 고려해보시는 건 어떻냥? 아니면 희망 지역 범위를 넓혀볼까냥?**"과 같이 이유를 설명하고 조건 조정을 유도합니다.
## 4. 제품 요구사항 (Product Requirements / Features) - 어떻게 구현할 것인가?
#### 4.0. 핵심 데이터 및 기술 접근 방식 (MVP)
- 데이터 기반: MVP는 초기 데이터 수집(**단순 크롤러 활용**)을 통해 확보된 정보를 바탕으로 **RAG 시스템을 구축**합니다. 실시간 데이터 연동 프로그램 개발은 MVP 이후 단계로 합니다. 초기에는 네이버 부동산 등에서 서울 시내 **주요 대장 아파트 단지들의 정보를 1회성 또는 배치 형태로 수집**하여 구조화하고, 이를 단지별 상세 정보 보고서 형태로 RAG 시스템의 지식 베이스(**부동산 KB**)로 활용합니다. 또한, 대출 관련 공신력 있는 문서(정부 정책, 금융기관 상품 개요 등)들을 수집/정제하여 별도의 지식 베이스(**대출 KB**)를 구축하고 RAG 시스템에 통합합니다. 첨부된 "**서울특별시_서초구_투자테이블_20250528.xlsx**"와 유사한 구조의 데이터를 **apartments 테이블 및 관련 테이블의 기초 데이터로 활용**하여 필터링 및 추천 로직을 구현합니다.
- 기술 아키텍처 컨셉: 핵심은 **Dify를 활용하여 구축된 RAG (Retrieval Augmented Generation) 챗 에이전트**입니다. 사용자의 자연어 질의를 이해하고, 초기 구축된 부동산 KB(Airtable/Supabase의 정형 데이터 필터링 결과와 연계) 및 대출 KB에서 관련 정보를 검색(Retrieval)한 후, 이를 바탕으로 LLM이 사용자 친화적인 답변을 생성(Generation)하여 "**집사 냥**" 캐릭터를 통해 전달합니다.
- 향후 확장 방향: MVP 이후, 실시간 데이터 연동 프로그램 개발, 데이터 수집 범위 전국 확대, 파트너십을 통한 직접 데이터 공급 확보, 사용자 행동 데이터 기반 개인화 추천 로직 강화, RAG 시스템의 지속적인 성능 최적화 및 기능 확장을 계획합니다.
#### 4.1. 핵심 기능 (Core Features - Must-have for MVP)
- 1. 모바일 웹앱 기반 대화형 AI 챗봇 인터페이스 ("집사 냥"):
	- 첫 화면 전체가 **채팅창으로 구성된 모바일 브라우저 전용 웹앱 인터페이스.**
	- **Dify 기반 RAG 시스템과 연동**되어, 사용자의 자연어 입력을 통해 매매 목적(갭투자/실거주), 연봉, 보유 현금, 출퇴근지 등 **핵심 변수 파악.**
	- 초기 수집된 부동산 데이터 및 학습된 대출 문서 기반의 답변 및 아파트 단지 추천 제공.
- 2. 아파트 단지 추천 로직 (Excel 데이터 기반 Top 3):
	- 사용자 조건(보유 현금, 예상 최대 대출액, 선호 면적 등)에 따른 **1차 필터링**: deal_price ≤ cash + max_loan.
	- 매매 목적(갭투자/실거주)에 따른 **2차 필터링 및 Top 3 아파트 단지 선정**:
		- 갭투자: "**시가 대비 괴리율(%)**" 또는 "**최근1년 상승률(%)**" 상위 3개 단지.
		- 실거주: "**강남역 출퇴근시간(분)**" 또는 "**지하철역 거리(m)**" 최저 3개 단지.
	- 선정된 Top 3 중 **첫 1개 단지 정보는 상세히(언블러) 제공**, 나머지 2개는 블러 처리하여 유료 플랜 가입 유도.
- 3. RAG 기반 주택담보대출 정보 안내 및 연계형 계산기:
	- 사용자의 대출 관련 질문에 대해 **대출 KB를 활용한 RAG 시스템**이 관련 정보, 용어 설명, 일반적인 절차 등을 안내.
	- 사용자가 제공하는 연봉, 기존 부채 등의 정보를 바탕으로 **예상 대출 가능 금액 범위 및 월 상환액을 계산**하여 제시 (참고용 명시).
- 4. Kakao 지도 API 연동 매물(단지) 정보 시각화:
	- 채팅창 내 "**지도 보기**" 버튼을 통해 **Kakao 지도 기반의 지도 뷰로 전환.**
	- 추천된 아파트 단지(최대 3개) 위치를 지도 위에 마커로 표시하고, 마커 클릭 시 핵심 정보 제공.
	- 사용자의 기본적인 지도 조작(확대/축소, 이동) 지원.
- 5. 세션 기반 개인 맞춤형 종합 리포트 생성 및 다운로드:
	- "오늘 대화 정리" 등 사용자 요청 시, 현재 세션의 대화 내용 요약, 추천 단지 상세 정보, "**집사 냥**"의 주요 분석 코멘트, 대출 안내 및 계산 결과 요약 등을 포함한 리포트를 **PDF 형식으로 생성하여 다운로드 제공.**
- 6. 이용 제한 기능:
	- 챗봇과의 총 대화 횟수 또는 하루 대화 횟수에 제한을 두어 과도한 사용 방지 및 유료 플랜 전환 고려. (MVP에서는 심플한 횟수 제한 우선)
#### 4.2. 기능 상세 명세 (Functional Requirements) - MVP
#### 4.2.1. UI/UX 기본 구조 가이드라인 (모바일 웹앱)
- FR-UIUX-001 (첫 화면 채팅창): 서비스 접속 시 별도의 랜딩 페이지 없이 즉시 "**집사 냥**"과의 대화를 시작할 수 있는 **전체 화면 채팅창 인터페이스를 제공**합니다. 하단에는 메시지 입력창과 전송 버튼이 위치합니다.
- FR-UIUX-002 (지도 보기 전환): 채팅창 내 특정 컨텍스트(예: 단지 추천 후) 또는 상시 접근 가능한 위치(예: 헤더, 플로팅 버튼)에 "**지도 보기**" 버튼을 제공합니다. 버튼 클릭 시 화면이 **Kakao 지도 API 기반의 지도 뷰로 전환**됩니다. 지도 뷰에서 다시 채팅창으로 돌아올 수 있는 명확한 UI(예: "채팅으로 돌아가기" 버튼)를 제공합니다.
- FR-UIUX-003 (모바일 최적화): 모든 UI 요소는 **모바일 브라우저 환경에 최적화**되어 터치 인터페이스에 적합해야 하며, 가독성 높은 폰트 크기와 충분한 터치 영역을 확보해야 합니다.
- FR-UIUX-004 (정보의 시각적 계층): 채팅 메시지, 추천 정보, 지도 위 정보 등에서 중요한 정보를 쉽게 인지할 수 있도록 **명확한 시각적 계층**(폰트 크기, 색상, 굵기 등)을 적용합니다.
- FR-UIUX-005 ("집사 냥" 캐릭터 활용): 채팅창 상단, 로딩 메시지, 추천 결과 등 주요 인터랙션 포인트에 "**집사 냥**" 캐릭터 아이콘 또는 간단한 애니메이션을 활용하여 **서비스의 친근함과 재미를 더하고, 사용자의 긍정적인 감성 경험을 유도**합니다.
#### 4.2.2. 대화형 AI 챗봇 인터페이스 ("집사 냥")
- FR-CHAT-001 (메시지 입출력): 사용자는 하단 텍스트 입력 필드를 통해 "**집사 냥**"에게 메시지를 전송할 수 있어야 합니다. 메시지 전송 시 채팅창 상단으로 스크롤되며 대화 내용이 누적되어 표시됩니다.
	- 디자인 가이드: 채팅창 헤더에는 "**집사냥 AI**" 로고와 "**집사 냥**" 캐릭터 아이콘을 배치합니다. 사용자 메시지와 "**집사 냥**" 메시지는 말풍선 형태로 구분되어 표시됩니다.
- FR-CHAT-002 (핵심 변수 자연어 파악): "**집사 냥**"은 대화 초기에 사용자의 **매매 목적(갭투자/실거주)**을 먼저 질문하고, 이후 연봉, 보유 현금, 출퇴근지(주요 업무 지구 또는 지하철역) 등의 **핵심 정보를 자연스러운 대화를 통해 순차적으로 또는 사용자의 자유로운 입력에 맞춰 파악**해야 합니다.
	- Dify 워크플로우 연계: 사용자 메시지는 **Dify의 extract_vars 단계를 통해 구조화된 user_profile_vars로 추출**됩니다.
	- 디자인 가이드: 주요 질문에는 사용자의 입력 편의를 위해 버튼 형태의 선택지(예: "실거주", "갭투자")를 함께 제공할 수 있습니다.
- FR-CHAT-003 (추출 정보 활용 및 RAG 연동): "**집사 냥**"은 추출된 user_profile_vars를 **Dify 워크플로우의 후속 단계(query_apartments, vector_search) 입력값으로 활용**하여 맞춤형 정보를 제공해야 합니다.
- FR-CHAT-004 (캐릭터 톤앤매너): "**집사 냥**"의 모든 응답은 미리 정의된 **친근하고 다정한 "집사 냥" 캐릭터의 톤앤매너**(예: 어미에 "~냥" 또는 "~냥?" 사용, 긍정적이고 격려하는 말투)를 일관되게 유지해야 합니다.
	- 디자인 가이드: "**집사 냥**"의 말풍선 옆에는 상황에 맞는 간단한 캐릭터 표정 변화(아이콘)를 추가할 수 있습니다.
- FR-CHAT-005 (조건 불충분 시 안내): 사용자가 특정 조건 입력을 건너뛰거나, "잘 모르겠어" 등으로 답변하여 추천에 필요한 핵심 정보가 부족할 경우, "**집사 냥**"은 **추가 정보 입력을 정중히 요청하거나 일반적인 기준으로 추천을 진행할 수 있음**을 안내해야 합니다. (예: "출퇴근지를 알려주시면 더 정확한 추천을 해드릴 수 있다냥! 아니면 서울 전체에서 찾아볼까냥?")
- FR-CHAT-006 (지도 보기 유도): 아파트 단지 추천 시, "**추천해드린 [A단지명] 외 Top 3 단지를 지도에서 함께 확인해보시겠냥? '지도 보기' 버튼을 눌러달라냥!**"과 같이 **Kakao 지도 뷰로 사용자의 시선을 유도하는 명확한 안내**를 해야 합니다.
- FR-CHAT-007 (추천 매물 부재 시 대응): 사용자가 입력한 조건에 부합하는 아파트 단지가 없을 경우, "**집사 냥**"은 "**애옹... 지금 조건으로는 딱 맞는 아파트를 찾기가 어렵다냥. 혹시 예산 범위를 조금 넓혀보거나, 다른 조건을 변경해서 다시 찾아볼까냥?**"과 같이 **친절하게 상황을 설명하고, 조건 변경을 통한 재탐색을 유도**해야 합니다.
- FR-CHAT-008 (대화 횟수 제한 알림): 정의된 무료 대화 횟수(예: 일일 10회)에 도달하면, "**집사 냥**"은 "**오늘 저와의 대화 시간이 거의 다 됐다냥! 더 많은 정보와 무제한 대화는 유료 플랜에서 이용할 수 있다냥! 내일 다시 찾아달라냥!**"과 같이 안내하고 추가적인 질의에 제한적으로 응답하거나 응답하지 않아야 합니다.
#### 4.2.3. AI 아파트 단지 추천 로직 (Excel 데이터 및 Dify 워크플로우 기반)
- FR-REC-001 (1차 필터링 - 자금 조건): **Dify 워크플로우의 query_apartments 단계**에서, 사용자의 user_profile_vars에 저장된 보유 현금과 예상 최대 대출 가능 금액 (FR-LOAN-003 결과)을 합산한 총 가용 자금을 기준으로, apartments 및 price_history 테이블 (Airtable/Supabase)의 **최근실거래가가 이보다 낮은 아파트 단지들을 1차 필터링**합니다. 사용자가 선호하는 전용면적(m^2) 범위가 있다면 이 역시 필터 조건에 포함합니다.
	- 데이터 참조: "**서울특별시_서초구_투자테이블_20250528.xlsx**"의 '최근실거래가', '전용면적(m^2)' 컬럼 참조.
- FR-REC-002 (2차 필터링 및 Top 3 선정 - 매매 목적별): 1차 필터링된 아파트 단지 리스트(apt_id 리스트)를 대상으로, **user_profile_vars의 매매 목적에 따라 다음 기준으로 Top 3 단지를 선정**합니다:
	- 갭투자 목적 시: apartments 테이블의 "**시가대비 괴리율(%)**"이 높거나 (해석: 저평가로 매수 기회), "**최근1년 상승률(%)**"이 높은 (해석: 상승 모멘텀 존재) 단지 순으로 정렬하여 상위 3개 선정. 두 지표를 종합적으로 고려하는 가중치 로직 적용 가능.
		- 데이터 참조: "**서울특별시_서초구_투자테이블_20250528.xlsx**"의 '**시가대비 괴리율(%)**', '**최근1년 상승률(%)**' 컬럼 참조. (괴리율은 수치가 클수록 좋은 것으로 해석)
	- 실거주 목적 시: user_profile_vars의 출퇴근지를 기준으로, apartments 또는 transport 테이블의 "**강남역 출퇴근시간(분)**"이 짧거나, "**지하철역 거리(m)**"가 가까운 단지 순으로 정렬하여 상위 3개 선정. 두 지표를 종합적으로 고려하는 가중치 로직 적용 가능.
		- 데이터 참조: "**서울특별시_서초구_투자테이블_20250528.xlsx**"의 '**강남역 출퇴근시간(분)**', '**지하철역 거리(m)**' 컬럼 참조. (두 지표 모두 수치가 낮을수록 좋음)
- FR-REC-003 (추천 이유 생성 - RAG): 선정된 Top 3 아파트 단지의 apt_id를 **Dify 워크플로우의 vector_search 단계로 전달**합니다. RAG 시스템은 각 단지 ID에 해당하는 부동산 KB(단지 정보 보고서, reviews 테이블 정보 요약 등)에서 해당 단지를 추천하는 이유(장점, 특징, 긍정적 리뷰 등)에 대한 근거 정보를 검색하고, 이를 바탕으로 LLM이 "**집사 냥**의 한마디!" 형태의 **개인화된 추천 이유를 생성**합니다.
- FR-REC-004 (추천 결과 제시 및 유료화 연동): **Top 3 추천 단지 중 첫 번째 단지에 대해서는 단지명, 핵심 정보, 추천 이유("집사 냥의 한마디") 등을 상세히(언블러) 제공**합니다. 나머지 2개 단지에 대해서는 단지명 정도만 간략히 언급하거나 주요 정보를 블러(blur) 처리하여 상세 정보 확인을 위해서는 유료 플랜 가입이 필요함을 안내합니다. (MVP에서는 실제 결제 없이 "**더 자세한 정보는 유료 플랜에서 제공됩니다, 냥!**" 정도의 안내)
#### 4.2.4. Kakao 지도 API 기반 매물(단지) 정보 시각화
- FR-MAP-001 (지도 뷰 전환 및 기본 표시): 사용자가 채팅창 내 "**지도 보기**" 버튼을 클릭하면, 화면이 **Kakao 지도 뷰로 전환**되어야 합니다. RAG 시스템이 추천한 아파트 단지(언블러된 1개 또는 Top 3 모두)의 위치가 **Kakao 지도 위에 커스텀 마커(예: "냥발바닥")로 명확하게 표시**되어야 합니다.
	- 디자인 가이드: 지도는 추천된 단지들이 모두 잘 보이도록 적절한 초기 위치와 축척으로 자동 조정됩니다.
- FR-MAP-002 (마커 클릭 시 정보 표시): 지도 마커 클릭 시, 해당 단지의 **핵심 정보(단지명, 주소, 대표 평형의 최근 시세 범위, "집사 냥의 한마디" 요약 등)가 간결한 정보창(Infowindow) 또는 지도 하단/사이드의 정보 패널 형태로 표시**되어야 합니다. 블러 처리된 단지의 경우 "**상세 정보는 유료 플랜에서 확인 가능하다냥!**" 문구를 표시합니다.
	- 디자인 가이드: 정보창은 모바일 화면에서 지도를 과도하게 가리지 않으면서 필요한 정보를 명확히 전달할 수 있도록 디자인합니다.
- FR-MAP-003 (기본 지도 조작): 사용자는 Kakao 지도의 기본적인 확대/축소, 드래그 이동 기능을 사용하여 추천된 단지 및 주변 환경을 자유롭게 탐색할 수 있어야 합니다.

- FR-MAP-005 (챗봇-지도 연동): 채팅창에서 특정 추천 단지를 다시 언급하거나 사용자가 선택하면, 지도 뷰로 전환 시 해당 단지 마커가 시각적으로 강조되거나 해당 위치로 지도가 부드럽게 이동하는 인터랙션을 제공합니다. (MVP에서는 단순 포커싱)

#### 4.2.5. RAG 기반 주택담보대출 정보 안내 및 계산기
- FR-LOAN-001 (대출 정보 질의 및 안내): 사용자가 챗봇을 통해 주택담보대출 관련 용어, 절차, 현재 주요 정책(LTV, DSR 등) 등에 대해 질문하면, "**집사 냥**"은 **Dify RAG 시스템을 통해 대출 KB에서 관련 정보를 검색하여 쉽고 친절하게 설명**해야 합니다. (예: 사용자: "DSR이 뭐야?" / 집사 냥: "DSR은 총부채원리금상환비율을 말한다냥. 쉽게 말해서 연봉 대비 매년 갚아야 하는 모든 대출의 원금과 이자가 얼마나 되는지를 보는 거다냥. 이게 너무 높으면 추가 대출이 어려울 수 있다냥.")
- FR-LOAN-002 (예상 대출액 계산을 위한 정보 입력): "**집사 냥**"은 대출 관련 안내 중 또는 사용자의 요청에 따라 예상 대출액 계산을 위해 필요한 정보(예: user_profile_vars의 연봉, 보유 현금, 그리고 사용자가 고려 중인 아파트의 예상 가격)를 활용하거나 추가 입력을 요청합니다.
- FR-LOAN-003 (예상 대출액 계산 및 결과 제시): 입력된 정보를 바탕으로 현재 시점의 일반적인 LTV, DSR 규제 및 loan_products 테이블의 참고 정보를 활용하여 **단순화된 예상 대출 가능 금액 범위 및 예상 월 상환액**(예시 금리 적용)을 계산하여 "**집사 냥**"이 사용자에게 안내합니다. Dify 워크플로우 내 코드 노드 또는 간단한 외부 API 호출로 구현 가능합니다.
- FR-LOAN-004 (주의사항 및 면책 조항 안내): 계산 결과는 일반적인 참고용 예상치이며, 실제 조건은 크게 달라질 수 있음을 명확히 고지합니다. "**이건 어디까지나 참고용이고, 정확한 건 꼭 은행 가서 상담받아보셔야 한다냥! 대출 상품이나 개인 신용도에 따라 많이 달라질 수 있다냥.**"과 같이 안내합니다.
#### 4.2.6. 세션 기반 개인 맞춤형 종합 리포트
- FR-REPT-001 (리포트 생성 요청): 사용자가 채팅창에서 "오늘 대화 정리해줘" 또는 유사한 요청을 하면, 리포트 생성 기능이 트리거됩니다.

- FR-REPT-002 (리포트 내용 구성): 리포트에는 다음 내용이 포함되어야 합니다:
	- 조회 일시 및 사용자의 주요 입력 조건 (user_profile_vars 기반: 매매 목적, 연봉, 보유 현금, 출퇴근지 등) 요약.
	- "**집사 냥**"이 추천한 Top 3 아파트 단지 목록 (첫 번째 단지는 상세 정보 - 단지명, 주소, 시세 범위, 주요 특징, 추천 이유 요약. 나머지 두 단지는 단지명 및 간략 정보 또는 "유료 플랜에서 확인" 안내).
	- 대출 관련 논의가 있었다면, "**집사 냥**"의 주요 안내 내용 및 예상 대출액 계산 결과 요약 (주의사항 포함).
	- (선택 사항) 추천 단지 중 상세 정보가 제공된 단지에 대한 가상 임장 루트 제안 (주요 교통편, 주변 편의시설 지도 스냅샷 또는 경로 설명).
- FR-REPT-003 (리포트 다운로드): 생성된 리포트는 **PDF 형식으로 모바일 브라우저에서 즉시 다운로드**할 수 있어야 합니다.
#### 4.3. 비기능적 요구사항 (Non-functional Requirements) - MVP
- 사용성 (Usability): **모바일 우선의 직관적이고 사용하기 쉬운 인터페이스.** 부동산 초보자도 별도의 학습 없이 "**집사 냥**"과의 대화를 통해 원하는 정보를 얻을 수 있어야 합니다.
- 성능 (Performance):
	- 챗봇 응답 시간은 **평균 2-3초 이내** (RAG 검색 및 LLM 생성 시간 포함).
	- 지도 로딩 및 단지 정보 표시 시간은 **3-5초 이내.**
	- 리포트 생성 시간은 **10초 이내.**
- 데이터 (Data):
	- 부동산 지식베이스 (MVP 초기): **단순 크롤러로 네이버 부동산 등에서 서울 주요 대장 아파트 단지(50~100개) 정보를 1회성/배치 수집.** "**서울특별시_서초구_투자테이블_20250528.xlsx**"의 컬럼 구조를 참조하여 Airtable/Supabase의 apartments, price_history, transport 테이블 데이터 구성 및 이를 기반으로 RAG용 단지별 정보 보고서 생성/구축. MVP 기간 중 데이터는 정적 유지 또는 수동 업데이트.
	- 대출 지식베이스: **공신력 있는 출처의 주택담보대출 일반 정보, 정책, 용어 해설 문서 수집/정제하여 구축.** 월 단위 이상 수동 업데이트 목표.
	- 데이터 정확성: 수집/입력된 데이터의 정확성은 "**정보 수집 시점 기준**"이며, 서비스 내에 이를 명시.
- 보안 (Security):
	- **HTTPS 통한 모든 통신 암호화.**
	- 사용자 입력 민감 정보(연봉 등)는 세션 중에만 사용하고, 세션 종료 시 또는 일정 시간 후 즉시 파기/비식별화. Dify 및 BaaS 플랫폼의 보안 기능 최대한 활용.
	- 크롤링 시 대상 사이트의 서비스 약관 및 robots.txt 준수.
- 안정성 (Reliability): MVP 단계에서는 **Best Effort로 안정적인 서비스 제공**을 목표로 하며, 주요 기능 장애 발생 시 최대한 빠른 복구를 지향합니다.
- 호환성 (Compatibility): 최신 버전의 주요 모바일 브라우저(Chrome, Safari 등)에서 정상 작동해야 합니다.

## 8. 개발 순서 및 접근 방식 (MVP)
AI Agent를 활용한 개발 효율성을 극대화하고, 단계별 검증을 통해 리스크를 최소화하는 순서로 진행합니다. 기간보다는 각 단계의 완료 조건 충족 및 문제 해결에 집중합니다.
- 1. Phase 1: **초기 데이터 수집을 위한 단순 크롤러 개발 및 기초 지식베이스 자료 확보**
	- 작업 내용:
		- 대상 사이트(네이버 부동산 등) 및 수집 항목 정의 (서울 주요 대장 아파트 단지 10~20개 중심의 기본 정보, "**서울특별시_서초구_투자테이블_20250528.xlsx**" 참조 컬럼 포함).
		- Python 기반 단순 크롤러 스크립트 개발 (data_collection/crawlers/).
		- 수집 데이터 1차 정제 및 구조화 (Airtable/Supabase 스키마에 맞게, RAG 지식베이스용 텍스트 파일 또는 CSV 형태로 knowledge_base_sources/real_estate_reports/에 저장).
		- 주택담보대출 관련 핵심 일반 정보 문서(LTV, DSR 정의, 주요 용어 해설 등) 3~5건 수집 및 정제 (knowledge_base_sources/loan_documents/에 저장).
	- 검증 목표: **RAG 학습 및 Airtable/Supabase 필터링을 위한 초기 데이터셋**(부동산, 대출) 확보. 크롤링 기본 로직 검증.
- 2. Phase 2: **Dify 기반 핵심 RAG 파이프라인 및 Airtable/Supabase 연동 준비**
	- 작업 내용:
		- **Dify 플랫폼 환경 설정 및 Dify 자체 Vector DB 설정.**
		- Phase 1에서 확보된 부동산 보고서(텍스트) 및 대출 문서를 Dify 지식베이스에 업로드, 임베딩.
		- Airtable/Supabase 설정 및 apartments, price_history, transport, loan_products 테이블 생성 및 Phase 1 데이터 초기 적재.
		- Dify 워크플로우 설계: extract_vars, query_apartments (Airtable/Supabase API 호출 Tool Node 활용), vector_search, LLM Generation 단계 정의.
		- 기본적인 RAG 파이프라인 테스트: 간단한 질의로 정보 검색 및 답변 생성 확인.
	- 검증 목표: **Dify 및 자체 Vector DB를 활용한 RAG 기본 동작, Airtable/Supabase 연동(Tool Node) 가능성 확인.**
- 3. Phase 3: "**집사 냥**" 챗봇 인터페이스 (모바일 웹앱) 및 기본 대화 흐름 구현
	- 작업 내용:
		- **모바일 웹앱 Frontend 개발 환경 설정** (frontend/).
		- 첫 화면 전체 채팅창 UI 구현. "**지도 보기**" 버튼 초기 레이아웃.
		- "**집사 냥**" 캐릭터 컨셉(톤앤매너, 말투) 정의 및 초기 대화 스크립트 템플릿.
		- **Frontend와 Dify RAG 파이프라인 연동**: 사용자 메시지 Dify 전달, Dify 응답 수신 및 챗봇창에 표시.
		- 핵심 대화 시나리오 1개 구현 (extract_vars 및 query_apartments 연동하여 추천 단지 ID 리스트 반환까지).
	- 검증 목표: **사용자와 "집사 냥" 간의 기본적인 대화 상호작용 및 RAG 시스템 연동**(변수 추출, 아파트 필터링) 정상 작동 확인.
- 4. Phase 4: **Kakao 지도 연동 및 추천 단지 시각화**
	- 작업 내용:
		- **Kakao 지도 API 연동 및 "지도 보기" 버튼 클릭 시 지도 뷰 전환 기능 구현.**
		- RAG 시스템이 추천한 단지(Top 3, Phase 2 지식베이스 및 Airtable/Supabase 데이터 기반)의 위치 정보를 받아 지도 위에 마커로 표시.
		- 마커 클릭 시 해당 단지의 기본 정보(단지명, 주소, 가격대 요약 등)를 간단한 정보창으로 표시. (첫 1곳 언블러, 나머지 블러 처리 UI 반영)
		- 기본적인 지도 조작(확대/축소, 이동) 기능 구현.
	- 검증 목표: **지도 연동 및 추천 결과의 기본적인 시각화 기능, 유료화 연계 블러 처리 UI 구현.**
- 5. Phase 5: **RAG 기반 대출 안내/계산기, 리포트 생성, 이용 제한 기능 구현**
	- 작업 내용:
		- **Dify RAG 파이프라인 확장**: 대출 KB 활용하여 대출 관련 질의응답 및 정보 안내 기능 상세 구현.
		- 간단한 형태의 예상 대출액 계산기 로직 구현 및 "**집사 냥**" 안내 연동.
		- 세션 기반 정보(user_sessions, user_profile_vars 임시 저장 활용)를 취합하여 PDF 리포트 생성 및 다운로드 기능 구현.
		- 챗봇 대화 횟수 제한 기능 구현 및 안내 메시지.
	- 검증 목표: **MVP 핵심 부가 기능들의 개별 동작 및 상호 연동성 확인.**
- 6. Phase 6: **지식베이스 확장 (추가 단지 크롤링/입력) 및 통합 테스트**
	- 작업 내용:
		- 초기 크롤러 또는 수동 입력을 통해 대상 단지 범위 확장 (서울 주요 대장 아파트 단지 50~100개 목표).
		- 수집/입력 데이터 정제 및 지식베이스(Dify Vector DB, Airtable/Supabase) 업데이트.
		- 확장된 KB 기반 RAG 시스템 성능 및 추천 품질 테스트.
		- **전체 기능 통합 테스트 및 주요 사용자 시나리오 기반 E2E 테스트.**
		- 내부 사용자 또는 소규모 FGT를 통한 사용성 피드백 수집.
		- 발견된 버그 수정 및 기능 안정화, 응답 속도 등 성능 최적화.
		- 배포 환경 설정 및 최종 점검.
	- 검증 목표: **확장된 데이터셋에서의 RAG 성능 점검, MVP 버전의 전반적인 품질 및 사용자 수용성 확보, 제한적 공개 또는 테스트 출시 준비 완료.**
## 9. 기술 및 보안 고려사항 (Technical & Security Considerations)
(이전 v1.4의 8. 기술 및 보안 고려사항 내용과 대부분 동일하게 유지하되, Airtable/Supabase 연동 관련 보안, Dify API Key 관리 강화 등을 명시합니다.)
#### 9.1. 성능 최적화
- RAG 시스템 응답 속도:
	- **효율적인 Vector DB 인덱싱 및 검색 쿼리 최적화** (Dify 설정 및 지식베이스 구조 최적화).
	- 지식베이스 문서의 적절한 청킹(chunking) 전략 및 메타데이터 활용.
	- LLM 응답 생성 시간 최소화를 위한 프롬프트 최적화, 모델 파라미터 튜닝, 경량 모델 고려 (Dify 설정).
	- **Dify 응답 스트리밍(Streaming) 적극 활용**하여 사용자의 체감 대기 시간 단축.
- Airtable/Supabase 쿼리 최적화: query_apartments 단계에서 실행되는 쿼리가 효율적으로 작성되어 응답 지연을 최소화하도록 합니다. 필요한 인덱스를 생성합니다.

- 데이터 수집 (초기 크롤러): 크롤링 대상 사이트의 부하를 최소화하기 위한 적절한 요청 간격 설정 및 효율적인 데이터 추출 로직 개발.
- Frontend 렌더링 (모바일 웹앱): 지도 및 다량의 정보 표시 시 가상 스크롤링, 코드 스플리팅, 이미지 최적화, PWA 기술 적용(선택 사항) 등 **모바일 환경에 최적화된 Frontend 최적화 기법 적용.**
- 캐싱: 자주 변경되지 않는 대출 일반 정보, Airtable/Supabase에서 조회된 단지 기본 정보 등은 적절한 캐싱 전략 고려 (Dify 또는 Frontend/BFF 캐시).
#### 9.2. 보안 전략
- Dify 플랫폼 보안: **Dify API Key는 환경 변수 등을 통해 서버 측(BFF 사용 시) 또는 안전한 방식으로 관리하고, 클라이언트(브라우저)에 직접 노출되지 않도록 합니다.** Dify 자체의 보안 기능(접근 제어, 감사 로그 등) 활용.
- Airtable/Supabase 접근 보안: API Key 또는 DB 접속 정보는 안전하게 관리하고, 최소 권한 원칙을 적용합니다. 데이터 전송 시 암호화된 연결(HTTPS)을 사용합니다.
- 크롤링 윤리 및 법규 준수: 대상 웹사이트(예: 네이버 부동산)의 **robots.txt 정책을 반드시 준수**. 과도한 요청으로 서버에 부담을 주지 않도록 요청 간 지연(delay) 설정 및 Rate Limiting 적용. 수집 데이터의 저작권 및 개인정보보호법 관련 법적 검토 필수.
- 정보 입력 및 세션 보안: 사용자가 입력하는 민감 정보(연봉 등)는 **HTTPS를 통한 모든 통신 구간에서 암호화.** MVP에서는 사용자 계정이 없으므로, user_sessions 및 user_profile_vars 관련 정보는 서버 측에서 안전하게 관리(또는 Dify 세션 활용)하고 세션 종료 시 또는 일정 시간 경과 후 개인 식별 가능성이 있는 정보는 즉시 파기하거나 비식별화 처리.
- LLM 안전성 및 신뢰성:
	- "**집사 냥**"이 부정확하거나 편향된 정보를 생성하지 않도록 Dify 내 프롬프트 엔지니어링 시 **강력한 가드레일(지시사항, 제약조건) 설정.**
	- RAG 시스템이 지식베이스 외부의 정보를 참조하거나 환각(Hallucination)을 통해 답변을 생성하지 않도록 최대한 제어.
	- 생성된 답변에 대해 민감 정보(개인 식별 정보, 과도한 금융 조언 등) 포함 여부 필터링 고려.
	- 부적절하거나 공격적인 사용자 입력에 대한 대응 방안 마련 (예: 정중한 거절 또는 대화 주제 전환).
- 의존성 관리: 사용하는 오픈소스 라이브러리(Dify 포함), 프레임워크, API 등의 보안 취약점 정기적 확인 및 최신 보안 패치 적용.

## 10. 테스트 전략 (Test Strategy)
(이전 v1.4의 10. 테스트 전략 내용과 대부분 동일하게 유지합니다. 테스트 대상에 Airtable/Supabase 연동, Kakao 지도 API 연동을 명시적으로 추가합니다.)
- 단위 테스트 (Unit Tests):
	- 데이터 크롤링 및 파싱 로직, 대출 계산 로직, Airtable/Supabase 데이터 처리 로직(있을 경우) 등 핵심 로직 모듈에 대한 단위 테스트 작성.
	- Dify 워크플로우 내 커스텀 코드 노드(있을 경우)에 대한 테스트.
- 통합 테스트 (Integration Tests):
	- Frontend - Dify API 연동 테스트 (요청/응답 정확성, 오류 처리).
	- Dify RAG 파이프라인 테스트 (**지식베이스 검색 정확도, LLM 답변 생성 품질, Airtable/Supabase Tool Node 연동 테스트**).
	- **Kakao 지도 API 연동 및 추천 단지 위치 표시 정확성, 정보창 내용 일치 테스트.**
	- 리포트 생성 모듈 테스트 (데이터 정확성, PDF 포맷팅).
- E2E (End-to-End) 테스트:
	- 주요 사용자 시나리오(페르소나 기반, 3.2 핵심 사용자 여정 등)에 대한 **전체 흐름 테스트.**
	- 다양한 조건 입력에 따른 추천 결과 및 지도 표시 정확성, 대출 안내 및 계산 결과의 합리성 검증.
	- 매물 부재 시 대응, 네트워크 오류, API 오류 등 예외 상황 처리 테스트.
- 사용성 테스트 (Usability Testing):
	- **소규모 실제 타겟 사용자 그룹(2040 아파트 매매 초보, 5~7명) 대상 모바일 웹앱 FGT**(Focus Group Test) 또는 개별 사용성 테스트 진행.
	- 과업 기반 테스트 (예: "챗봇을 통해 10억 이하 강남 30평대 아파트 추천받고 대출 정보 확인하기").
	- "**집사 냥**" 캐릭터 호감도, 대화 흐름의 자연스러움, 정보의 유용성 및 신뢰성, 모바일 UI 편의성, 지도 보기 전환 경험 등 정성적 피드백 집중 수집.
	- Think Aloud Protocol 활용하여 사용자의 사고 과정 파악.
- 지식베이스 품질 검증:
	- RAG 시스템의 답변 정확도 및 정보 일관성 유지를 위해 **지식베이스(초기 구축된 부동산 보고서, 대출 문서) 내용의 주기적인 검토 및 (MVP 이후) 업데이트 프로세스 수립.** (MVP에서는 초기 구축된 정보의 정확성 및 일관성 검증에 집중)
	- 잘못된 정보나 환각(Hallucination) 답변 생성 사례 발생 시, 즉각적인 피드백 루프를 통해 원인 분석(프롬프트, 지식베이스, LLM 모델 등) 및 수정 방안 마련.
## 11. 문서화 및 유지보수 전략 (Documentation & Maintenance Strategy)
#### 11.1. 문서화
- 본 PRD 문서: **제품 개발의 기준 문서로 활용**되며, 주요 변경 사항 발생 시 버전 관리를 통해 지속적으로 업데이트합니다.
- API 문서 (Dify 및 내부 API):
	- Dify: Dify 플랫폼 내에서 관리되는 워크플로우 설정, 사용된 LLM 모델 종류 및 버전, 핵심 프롬프트 템플릿, 지식베이스 구성 및 업데이트 내역, Tool Node 설정(Airtable/Supabase 연동 정보) 등을 별도 문서(예: Confluence, Notion)에 상세히 기록하고 공유합니다.
	- 내부 API (리포트 생성 등, 있을 경우): Swagger/OpenAPI 스펙을 활용하여 자동 생성된 API 문서를 제공하고, API 변경 시 문서를 동기화합니다.
- 지식베이스 및 데이터베이스 관리 문서:
	- 부동산 단지 정보 보고서 및 대출 정보 문서의 원본 출처, (MVP)초기 데이터 수집 방법, 정제 규칙, 각 항목의 의미, 데이터 포맷, 최종 업데이트 일자 등을 체계적으로 기록합니다.
	- Airtable/Supabase 테이블 스키마 정의서(5. 데이터 모델 참조) 및 필드 설명을 별도로 관리합니다.
- 기술 아키텍처 문서: 시스템 구성도(1.5 아키텍처 개요 참조), 주요 컴포넌트 간 데이터 흐름도, 사용된 핵심 기술 및 라이브러리 버전, 인프라 구성 정보, 주요 기술 결정 사항 및 그 근거를 기록합니다.
- 코드 내 주석 및 Docstring: 모든 주요 함수, 클래스, 모듈에 대해 **가독성 및 유지보수 용이성을 높이기 위한 상세한 주석 및 Docstring 작성**을 표준화합니다.
- 운영 가이드 (MVP 최소 버전): 초기 데이터 수집 스크립트 실행 방법, Dify 어플리케이션 모니터링 및 재시작 절차, Airtable/Supabase 데이터 확인 방법, 주요 장애 발생 시 초기 대응 방안 등을 포함한 간략한 운영 가이드를 작성합니다.
#### 11.2. 유지보수 전략
- 데이터 모니터링 및 관리 (MVP):
	- **초기 구축된 부동산 지식베이스 데이터 및 Airtable/Supabase 데이터의 정합성 및 일관성을 유지**합니다.
	- 대출 KB는 주요 정책 변경 시 수동으로 업데이트하는 것을 목표로 합니다. (MVP 이후 자동화 고려)
- RAG 시스템 성능 모니터링 (Dify 활용 또는 자체 구축):
	- 사용자 질의에 대한 **검색 정확도, 답변 생성 품질, 응답 속도 등 주요 성능 지표를 지속적으로 모니터링**합니다.
	- 사용자 피드백(예: 답변 만족도 평가 기능), 시스템 로그 분석, 주기적인 샘플 질의 테스트를 통해 개선 영역을 발굴하고, 프롬프트 엔지니어링, 지식베이스 내용 보강 등의 개선 작업을 수행합니다.
- 오류 보고 및 처리: 사용자 또는 내부 테스트를 통해 발견된 버그 및 오류는 이슈 트래킹 시스템(예: Jira, GitHub Issues)에 체계적으로 기록하고, 심각도 및 우선순위에 따라 신속히 분석 및 처리합니다.

- 정기적인 코드 리뷰 및 리팩토링: 코드 품질 유지를 위해 개발 과정에서 동료 코드 리뷰를 생활화하고, MVP 출시 이후에도 주기적으로 코드 베이스를 점검하여 기술 부채를 최소화하고 가독성 및 유지보수성을 향상시키기 위한 리팩토링을 진행합니다.

- 기술 스택 업데이트 및 보안 관리: 사용하는 프레임워크, 라이브러리, Dify 플랫폼, LLM 모델 등의 최신 버전 정보 및 보안 패치 릴리즈를 주기적으로 확인하고, 테스트 후 안정적으로 적용하는 것을 목표로 합니다. 정기적인 보안 취약점 점검을 수행합니다.

## 12. 성공 지표 (Success Metrics / KPIs) - MVP
- 사용자 참여도 (Engagement):
	- MVP 테스트 기간 동안의 **총 순 사용자 수(Unique Users) 및 총 세션 수**
	- **1인당 평균 대화 턴(turn) 수 및 평균 세션 시간**
	- 아파트 단지 추천 기능까지 도달하는 사용자 비율 (Funnel Analysis)
	- 일일/주간 대화 횟수 제한 도달 사용자 비율
- 핵심 기능 사용률 (Adoption):
	- "**지도 보기**" 버튼 클릭률 및 지도 뷰 이용 시간
	- RAG 기반 대출 안내/계산기 기능 사용률
	- 세션 기반 종합 리포트 생성/다운로드 수
	- 첫 번째 추천 단지 외 블러 처리된 단지 정보 확인 시도율 (유료화 전환 유도 지표)
- 사용자 만족도 (Satisfaction):
	- 테스트 참여자 대상 설문조사: "**전반적인 서비스 경험 만족도**" (5점 척도, **목표 3.8점 이상**)
	- 테스트 참여자 대상 설문조사: "**AI 추천 아파트 단지가 나의 조건과 얼마나 부합하는가?**" (5점 척도, **목표 3.5점 이상** 및 정성적 피드백 수집)
	- 테스트 참여자 대상 설문조사: "'**집사 냥**' 캐릭터 및 대화 경험 호감도" (5점 척도, **목표 4.0점 이상**)
	- 테스트 참여자 대상 설문조사: "**대출 정보 안내 및 계산 결과의 유용성**" (5점 척도, **목표 3.5점 이상**)
- 과업 완료율 (Task Completion):
	- 사용자가 의도한 조건(매매 목적, 예산, 지역 등)을 챗봇에게 성공적으로 전달하고, 관련 아파트 단지 정보 및 대출 정보를 확인하는 **핵심 과업의 완료율 (목표 70% 이상)**
- 기술적 안정성:
	- 서비스 가용 시간 (Uptime) (**목표: 99.5%**)
	- 심각한 기능 장애 또는 사용을 중단시키는 오류 발생 빈도 (테스트 기간 동안 **1회 미만 목표**)
	- 페이지 로딩 속도 및 챗봇 응답 속도 평균치
## 13. 프로젝트 디렉토리 구조 및 구성 원칙
#### 13.1. 전체 개요
본 "**집사냥 AI**" 프로젝트는 도메인 중심적인 접근과 계층화된 아키텍처 원칙을 기반으로 각 영역을 모듈화하여 개발합니다. **핵심 AI 기능은 Dify 플랫폼을 중심으로 오케스트레이션**되며, 필요한 경우 경량의 Python FastAPI 기반 백엔드(BFF 역할 또는 Dify가 직접 처리하기 어려운 부가 기능용)를 구성합니다. 데이터 수집 및 지식베이스 구축은 별도의 파이프라인으로 관리합니다. 이를 통해 각 컴포넌트의 역할을 명확히 분리하고 유지보수성과 확장성을 높이는 것을 목표로 합니다.
#### 13.2. 디렉토리 구조 (예시)
<smtcmp_block language="markdown">
JibsanyangAI/                 # 프로젝트 루트 디렉토리
├── .github/                  # GitHub Actions 및 CI/CD 설정 파일
│   └── workflows/            # CI/CD 파이프라인 및 워크플로우 정의
│
├── .vscode/                  # VS Code 개발 환경 설정 파일 (선택 사항)
│   ├── extensions.json       # 추천 확장 프로그램
│   ├── launch.json           # 디버깅 설정
│   └── settings.json         # 워크스페이스 설정
│
├── app/                      # 경량 백엔드 애플리케이션 (FastAPI 기반 BFF 또는 부가 기능 API - 선택 사항)
│   ├── main.py               # FastAPI 실행 진입점
│   │
│   ├── apis/                 # API 라우팅 계층
│   │   └── v1/               # API 버전 1
│   │       ├── chatbot.py    # 챗봇 상호작용 프록시/BFF 엔드포인트 (Dify 연동)
│   │       └── reports.py    # 리포트 생성 관련 엔드포인트
│   │
│   ├── common/               # 백엔드 프로젝트 전반에서 사용되는 공통 기능
│   │   ├── constants.py      # 상수 정의
│   │   ├── enums.py          # 열거형 정의
│   │   ├── responses.py      # 표준 응답 형식 정의
│   │   └── utils.py          # 공