
---
created: 2025-05-28 T23:11
modify: 2025-05-29 T21:53
---
---
## 0. 문서 정보 (Document Information)
- 제품명: **집사냥 AI**
- 문서 버전: **1.6**
- 작성일: 2025년 5월 21일
- 최종 수정일: 2025년 5월 29일
- 작성자: 프로젝트 담당팀
- 관련 팀/담당자: 기획, 디자인, 개발, 마케팅

- 변경 이력 (Change History):
- v1.6 (2025.05.29): **Dify 대신 직접 OpenAI API 연동으로 변경, 자체 개발한 필터링 및 추천 알고리즘 적용, PostgreSQL + Drizzle ORM 기반 데이터베이스 구조, Express.js 백엔드 아키텍처 반영**
- v1.5 (2025.05.28): 서비스 초점(아파트 매매 한정, 투자 목적 구체화), 모바일 웹앱 UX(채팅창 중심, Kakao 지도), Dify 워크플로우 상세화, DB스키마 변경(Airtable/Supabase 기준, Excel 데이터 참조), 추천 필터링 로직(Excel 데이터 기반 Top3), 유료화 및 이용 제한, 세션 리포트 등 대규모 업데이트 및 PRD 구조 개편.

## 1. 개요 (Overview / Executive Summary)
#### 1.1. 제품 요약 (Product Summary)
"**집사냥 AI**"는 **아파트 '매매'**를 고려하는 사용자들이 겪는 **정보 비대칭과 의사결정의 어려움을 해결하기 위한 모바일 웹앱 기반 대화형 AI 어드바이저 플랫폼**입니다. 친근한 "**집사 냥**" 캐릭터와 **직접 구현된 OpenAI GPT-4o API 연동**을 통해 구축된 자연어 처리 시스템을 활용하여 사용자의 다양한 매매 목적(**실거주 또는 갭투자**)과 복합적인 상황(연봉, 보유 현금, 출퇴근지 등)을 쉽고 자연스럽게 파악합니다. 

**자체 개발한 추천 알고리즘**을 통해 개인에게 최적화된 아파트 단지 추천(**최대 3개, 초기 1개 언블러**)부터, 대출 관련 계산 및 안내, 그리고 세션 기반 개인 맞춤형 종합 리포트 생성까지 **원스톱으로 제공**하여 사용자의 성공적인 아파트 매매 여정을 지원하는 것을 목표로 합니다. 첫 화면은 **채팅창 중심**으로 구성되며, 필요시 **Kakao 지도 기반의 지도 뷰**로 전환하여 시각적인 정보를 제공합니다.

#### 1.2. 배경 및 문제 정의 (Background & Problem Statement)
아파트 매매는 개인의 삶에 중대한 영향을 미치는 재정적 결정이지만, 시장 정보는 방대하고 전문적이어서 지식과 경험이 부족한 개인, 특히 **20-40대 아파트 매매 초보자**에게는 높은 진입 장벽으로 작용합니다. 이들은 신뢰할 수 있는 아파트 가격 정보, 단지의 실제적인 장단점, 복잡한 시장 상황 분석, 개인의 재정 상황에 맞는 자금 조달 계획(특히 대출), 그리고 자신의 매매 목적(실거주 혹은 갭투자)에 부합하는 최적의 단지 선택에 큰 어려움을 느낍니다.

#### 1.3. 목표 및 기대 효과 (Goals & Objectives)
- 제품 비전: 모든 사용자가 자신의 아파트 매매 목적(**실거주 또는 갭투자**)을 성공적으로 달성할 수 있도록, **데이터 기반의 가장 스마트하고 신뢰할 수 있으며 사용하기 쉬운 모바일 AI 어드바이저가 되는 것**입니다.

#### 1.4. 주요 기술 스택 (Key Technical Stack)
- **Frontend**: React + TypeScript (모바일 웹앱)
- **Backend**: Express.js + TypeScript
- **Database**: PostgreSQL + Drizzle ORM
- **AI Engine**: OpenAI GPT-4o (직접 API 연동)
- **Map Service**: Kakao 지도 API
- **추천 시스템**: 자체 개발 점수 계산 알고리즘
- **Authentication & Sessions**: 세션 기반 사용자 상태 관리

#### 1.5. 아키텍처 개요 (Architecture Overview)
"**집사냥 AI**"는 **Express.js 기반 RESTful API 백엔드**와 **React 기반 모바일 웹앱 프론트엔드**로 구성된 **직접 구현 아키텍처**입니다.

**핵심 구성요소:**
1. **Frontend (React + TypeScript)**: 모바일 최적화 채팅 인터페이스
2. **Backend API (Express.js)**: RESTful API 서버, OpenAI 연동, 비즈니스 로직
3. **Database (PostgreSQL + Drizzle)**: 아파트 데이터, 사용자 세션, 채팅 기록
4. **AI Service (OpenAI GPT-4o)**: 자연어 처리, 사용자 정보 추출, 대화 생성
5. **Recommendation Engine**: 자체 개발 아파트 추천 알고리즘
6. **External APIs**: Kakao 지도 API

## 2. 타겟 사용자 (Target Audience / Personas)
#### 2.1. 주요 타겟 고객 정의
아파트 '**매매**'(실거주 또는 갭투자 목적)를 통해 주거 안정 또는 자산 증식을 목표로 하며, 이를 위해 적극적으로 정보를 탐색하지만 **전문적인 분석과 개인 맞춤형 조언을 필요로 하는 20대 후반 ~ 40대 사용자 그룹.**

#### 2.2. 페르소나 (기존 v1.5와 동일)
- 페르소나 1: **이지혜 (33세, 생애 첫 아파트 실거주 매매 고려)**
- 페르소나 2: **박현우 (38세, 아파트 갈아타기 및 갭투자 고려)**  
- 페르소나 3: **김민준 (29세, 첫 아파트 갭투자 고려)**

## 3. 핵심 사용자 스토리 및 여정
#### 3.1. 핵심 사용자 여정 (실제 구현 기준)
1. **서비스 접속**: 모바일 브라우저로 접속 시 자동으로 채팅 세션 생성
2. **"집사 냥"과 대화 시작**: 환영 메시지 후 자연스러운 대화로 정보 수집
3. **정보 추출 및 분석**: OpenAI API를 통한 사용자 정보 추출 및 재정 분석
4. **아파트 추천**: 자체 알고리즘을 통한 Top 3 단지 추천 (1개 무료, 2개 프리미엄)
5. **지도 확인**: Kakao 지도를 통한 위치 시각화
6. **리포트 생성**: 세션 기반 종합 분석 리포트

## 4. 제품 요구사항 (Product Requirements / Features)

#### 4.1. 핵심 기능 (Core Features)

##### 4.1.1. AI 채팅 시스템
- **OpenAI GPT-4o 직접 연동**: 사용자 메시지 이해 및 응답 생성
- **정보 추출**: 매매 목적, 연봉, 보유 현금, 출퇴근지 등 자동 파싱
- **재정 분석**: LTV/DSR 기반 예산 계산 및 대출 가능액 산정
- **대화 흐름 관리**: 세션 기반 대화 상태 및 컨텍스트 유지

##### 4.1.2. 아파트 추천 엔진
- **다단계 필터링**: 예산, 거래 유형, 지역 기반 1차 필터링
- **점수 계산 시스템**: 목적별(실거주/갭투자) 가중치 적용
- **Top 3 추천**: 개인화된 순위 기반 추천 결과
- **프리미엄 모델**: 첫 번째 추천 무료, 나머지 유료

##### 4.1.3. 지도 연동 및 시각화
- **Kakao 지도 API**: 추천 단지 위치 표시
- **마커 정보**: 단지별 상세 정보 팝업
- **모바일 최적화**: 터치 기반 지도 조작

##### 4.1.4. 세션 관리 및 리포트
- **세션 기반 상태 관리**: 사용자별 대화 이력 및 프로필 저장
- **종합 리포트**: PDF 형태의 분석 결과 다운로드

#### 4.2. 데이터 모델 (Database Schema)

```typescript
// 주요 테이블 구조
apartments: {
  complexNo: number;
  complexName: string;
  sigungu: string;
  dongName: string;
  latitude: number;
  longitude: number;
}

apartmentPrices: {
  complexNo: number;
  transactionType: '매매' | '전세';
  salePrice: number;
  leasePrice: number;
  gap: number;
  leaseRate: number;
}

chatSessions: {
  sessionId: string;
  userProfile: object;
  maxBudget: number;
  maxLoan: number;
}

chatMessages: {
  sessionId: string;
  role: 'user' | 'assistant';
  content: string;
  metadata: object;
}
```

## 5. 기술 아키텍처 및 워크플로우

#### 5.1. 시스템 아키텍처
```
[Mobile Web App (React)]
        ↕ HTTP/REST API
[Express.js Backend]
        ↕
[PostgreSQL Database] + [OpenAI GPT-4o API] + [Kakao Maps API]
```

#### 5.2. 핵심 워크플로우

##### 워크플로우 1: 채팅 메시지 처리
```
1. 사용자 메시지 입력
2. 세션 및 메시지 저장
3. OpenAI API로 정보 추출
4. 재정 분석 (충분한 정보 시)
5. 아파트 추천 실행
6. AI 응답 생성
7. 응답 저장 및 반환
```

##### 워크플로우 2: 아파트 추천 알고리즘
```
1. 사용자 프로필 기반 필터링
   - 예산 범위 (보유현금 + 최대대출)
   - 매매 목적 (실거주/갭투자)
   
2. 점수 계산
   - 실거주: 출퇴근 편의성, 생활 인프라
   - 갭투자: 수익률, 시장 상승 잠재력
   
3. Top 3 선정 및 순위 결정

4. 프리미엄 처리
   - 1위: 상세 정보 제공
   - 2-3위: 제한된 정보 (프리미엄 유도)
```

#### 5.3. API 엔드포인트 구조
```
POST /api/chat/session          - 새 채팅 세션 생성
GET  /api/chat/:sessionId/messages - 채팅 이력 조회
POST /api/chat/:sessionId/message  - 메시지 전송
GET  /api/apartments/:complexNo    - 아파트 상세 정보
GET  /api/apartments/search        - 아파트 검색
```

## 6. 구현된 핵심 서비스

#### 6.1. ChatGPTService
- **사용자 정보 추출**: 자연어에서 구조화된 데이터 추출
- **재정 분석**: LTV/DSR 기반 대출 가능액 계산
- **대화 생성**: 컨텍스트 기반 "집사 냥" 톤앤매너 응답
- **추천 이유 생성**: 개인화된 추천 설명

#### 6.2. ApartmentRecommender
- **다단계 필터링**: 예산, 목적, 지역 기반
- **점수 계산**: 가중치 기반 종합 평가
- **추천 생성**: Top 3 개인화 추천

#### 6.3. Database Layer (Drizzle ORM)
- **타입 안전성**: TypeScript 기반 스키마 정의
- **관계형 데이터**: 아파트, 가격, 세션, 메시지 테이블 연동
- **쿼리 최적화**: 효율적인 데이터 조회

## 7. 개발 순서 및 현재 상태

#### 7.1. 완료된 기능
- ✅ PostgreSQL 데이터베이스 스키마
- ✅ Express.js API 서버
- ✅ OpenAI GPT-4o 연동
- ✅ 자체 추천 알고리즘
- ✅ React 모바일 웹앱
- ✅ 채팅 인터페이스
- ✅ 세션 관리

#### 7.2. 진행 중인 작업
- 🔄 Kakao 지도 API 연동
- 🔄 리포트 생성 기능
- 🔄 프리미엄 기능 완성

#### 7.3. 다음 단계
- 📋 실제 데이터 임포트
- 📋 성능 최적화
- 📋 사용자 테스트

## 8. 성공 지표 (Success Metrics / KPIs)
- **사용자 참여도**: 세션당 평균 대화 수, 추천 완료율
- **추천 품질**: 사용자 만족도, 추천 수용률
- **기술적 성능**: 응답 시간, 시스템 안정성
- **비즈니스 지표**: 프리미엄 전환율, 사용자 재방문율

## 9. 보안 및 개인정보 보호
- **HTTPS 통신**: 모든 데이터 전송 암호화
- **API 키 관리**: 환경 변수 기반 보안 키 관리
- **세션 보안**: 세션 기반 임시 데이터 관리
- **개인정보 최소화**: 필요 최소한의 정보만 수집

## 10. 확장 계획
- **데이터 확장**: 전국 단위 아파트 정보
- **기능 확장**: 실시간 시세 연동, 고급 분석
- **플랫폼 확장**: PWA, 모바일 앱
- **파트너십**: 부동산 중개사, 금융기관 연동
